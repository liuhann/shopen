(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["story-manage"],{"1de8":function(e,t,r){},"4de0":function(e,t,r){"use strict";r.d(t,"a",function(){return o});var n=r("5176"),a=r.n(n),i=(r("96cf"),r("3b8d")),u=r("d225"),c=r("b0b4"),o=function(){function e(t,r){Object(u["a"])(this,e),this.ctx=t,this.path=r}return Object(c["a"])(e,[{key:"list",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,r,n){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.ctx.get("".concat(this.path,"/list"),{searchParams:a()(t,{page:r,count:n})}).json();case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},e,this)}));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"regex",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,r,n){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.ctx.get("".concat(this.path,"/regex/").concat(t,"/").concat(r,"?limit=").concat(n||1e3),{}).json();case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"patch",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.ctx.ky.patch("".concat(this.path,"/").concat(t),{json:r});case 2:case"end":return e.stop()}},e,this)}));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"delete",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.ctx.delete("".concat(this.path,"/").concat(t._id)).json();case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}]),e}()},"61af":function(e,t,r){"use strict";var n=r("1de8"),a=r.n(n);a.a},"70e1":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"album-manage"}},[r("table",[e._m(0),e._l(e.albums,function(t){return r("tr",{key:t._id,staticClass:"one-album"},[r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"album.name"}],staticStyle:{width:"300px"},domProps:{value:t.name},on:{input:function(r){r.target.composing||e.$set(t,"name",r.target.value)}}})]),r("td",[r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.cover,expression:"album.cover"}],domProps:{value:t.cover},on:{input:function(r){r.target.composing||e.$set(t,"cover",r.target.value)}}})]),r("td",[r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.desc,expression:"album.desc"}],staticStyle:{width:"300px"},domProps:{value:t.desc},on:{input:function(r){r.target.composing||e.$set(t,"desc",r.target.value)}}})]),r("td",[e._v(e._s(t.stories)),r("input",{directives:[{name:"model",rawName:"v-model",value:t.today,expression:"album.today"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.today)?e._i(t.today,null)>-1:t.today},on:{change:function(r){var n=t.today,a=r.target,i=!!a.checked;if(Array.isArray(n)){var u=null,c=e._i(n,u);a.checked?c<0&&e.$set(t,"today",n.concat([u])):c>-1&&e.$set(t,"today",n.slice(0,c).concat(n.slice(c+1)))}else e.$set(t,"today",i)}}})]),r("td",[r("a",{on:{click:function(r){return e.saveAlbum(t)}}},[e._v("更新")]),r("a",{on:{click:function(r){return e.deleteAlbum(t)}}},[e._v("删除")])])])})],2)])},a=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("tr",[r("th",[e._v("名称")]),r("th",[e._v("cover")]),r("th",[e._v("描述")]),r("th",[e._v("推荐")]),r("th",{staticStyle:{width:"120px"}},[e._v("操作")])])}],i=(r("7f7f"),r("96cf"),r("3b8d")),u=r("4de0"),c={data:function(){return{albums:[]}},mounted:function(){this.albumdao=new u["a"](this.ctx,"ybstory/album"),this.storydao=new u["a"](this.ctx,"ybstory/story"),this.loadCurrentPage()},methods:{loadCurrentPage:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.albumdao.list({sort:"u",order:"-1"},1,1e3);case 2:t=e.sent,this.albums=t.list;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),saveAlbum:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.storydao.regex("album",t.name);case 3:return r=e.sent,e.next=6,this.albumdao.patch(t._id,{cover:t.cover,desc:t.desc,stories:r.result.length});case 6:e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:case"end":return e.stop()}},e,this,[[0,8]])}));function t(t){return e.apply(this,arguments)}return t}(),deleteAlbum:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.ctx.storydao.deleteAlbum(t);case 2:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},o=c,s=r("2877"),l=Object(s["a"])(o,n,a,!1,null,null,null);t["default"]=l.exports},"8c60":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"story-manage"},[e.currentPlaying?r("div",{staticClass:"play"},[r("audio",{attrs:{src:e.currentPlaying,controls:"controls",loop:"loop",autoplay:"autoplay"}})]):e._e(),r("div",{staticClass:"query"},[r("div",[e._v("\n      标题 "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.titleSearch,expression:"titleSearch"}],domProps:{value:e.titleSearch},on:{input:function(t){t.target.composing||(e.titleSearch=t.target.value)}}}),r("a",{on:{click:e.searchStory}},[e._v("搜索")]),e._v("\n      专辑 "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.albumSearch,expression:"albumSearch"}],domProps:{value:e.albumSearch},on:{input:function(t){t.target.composing||(e.albumSearch=t.target.value)}}}),r("a",{on:{click:e.searchByAlbum}},[e._v("按标题")]),e._v("\n      路径 "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.pathSearch,expression:"pathSearch"}],domProps:{value:e.pathSearch},on:{input:function(t){t.target.composing||(e.pathSearch=t.target.value)}}}),r("a",{on:{click:e.searchByPath}},[e._v("按路径")])])]),r("div",{staticClass:"pager"},[r("a",{on:{click:function(t){return e.jumpPage(-1)}}},[e._v("上页")]),r("a",{on:{click:function(t){return e.jumpPage(1)}}},[e._v("下页")]),r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentPage,expression:"currentPage",modifiers:{number:!0}}],domProps:{value:e.currentPage},on:{input:function(t){t.target.composing||(e.currentPage=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),r("a",{on:{click:function(t){return e.jumpPage(0)}}},[e._v("跳转")]),r("a",{on:{click:e.deleteRemoved}},[e._v("删除标记故事")])]),r("div",{staticClass:"story-list"},[r("table",[e._m(0),e._l(e.tableData,function(t){return r("tr",{key:t._id,staticClass:"one-story"},[r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"story.title"}],staticStyle:{width:"300px"},domProps:{value:t.title},on:{input:function(r){r.target.composing||e.$set(t,"title",r.target.value)}}})]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.album,expression:"story.album"}],domProps:{value:t.album},on:{input:function(r){r.target.composing||e.$set(t,"album",r.target.value)}}})]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.label,expression:"story.label"}],domProps:{value:t.label},on:{input:function(r){r.target.composing||e.$set(t,"label",r.target.value)}}})]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.teller,expression:"story.teller"}],domProps:{value:t.teller},on:{input:function(r){r.target.composing||e.$set(t,"teller",r.target.value)}}})]),r("td",[e._v(e._s(t.deleted)+"-"+e._s(t.path))]),r("td",[r("a",{on:{click:function(r){return e.saveStory(t)}}},[e._v("更新")]),r("a",{on:{click:function(r){return e.playStory(t)}}},[e._v("播放")]),r("a",{on:{click:function(r){return e.deleteStory(t)}}},[e._v("删除")])])])})],2)]),r("div",{staticClass:"pager"},[r("a",{on:{click:function(t){return e.jumpPage(-1)}}},[e._v("上页")]),r("a",{on:{click:function(t){return e.jumpPage(1)}}},[e._v("下页")]),r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.currentPage,expression:"currentPage",modifiers:{number:!0}}],domProps:{value:e.currentPage},on:{input:function(t){t.target.composing||(e.currentPage=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),r("a",{on:{click:function(t){return e.jumpPage(0)}}},[e._v("跳转")])])])},a=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("tr",[r("th",[e._v("标题")]),r("th",[e._v("专辑")]),r("th",[e._v("标签")]),r("th",[e._v("主播")]),r("th",{},[e._v("路径")]),r("th",{staticStyle:{width:"160px"}},[e._v("操作")])])}],i=r("795b"),u=r.n(i),c=(r("96cf"),r("3b8d")),o=r("4de0"),s={data:function(){return{CDN_IMG:"http://imagek.cdn.bcebos.com",titleSearch:"",albumSearch:"",pathSearch:"",pageToGo:"",queryText:"",showRelatedStory:!1,showSearchDialog:!1,relatedStories:[],currentPage:1,pageSize:50,total:0,tableData:[],loading:!1,currentPlaying:null,dialogFormVisible:!1}},created:function(){this.storydao=new o["a"](this.ctx,"ybstory/story")},mounted:function(){this.loadCurrentPage()},methods:{searchStory:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.storydao.regex("title",this.titleSearch);case 2:t=e.sent,this.tableData=t.result;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),searchByAlbum:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.storydao.regex("album",this.albumSearch);case 2:t=e.sent,this.tableData=t.result;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),searchByPath:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.storydao.regex("path",this.pathSearch);case 2:t=e.sent,this.tableData=t.result;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),jumpPage:function(e){this.currentPage+=e,this.loadCurrentPage()},loadCurrentPage:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.storydao.list({},this.currentPage,this.pageSize);case 3:t=e.sent,this.loading=!1,this.tableData=t.list,this.total=t.total;case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),saveStory:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.storydao.patch(t._id,{title:t.title,album:t.album,label:t.label,teller:t.teller});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e["catch"](0);case 7:case"end":return e.stop()}},e,this,[[0,5]])}));function t(t){return e.apply(this,arguments)}return t}(),playStory:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.currentPlaying="http://chuchu.cdn.bcebos.com/"+t.path;case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),deleteStory:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.storydao.patch(t._id,{deleted:!0});case 2:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),deleteRemoved:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.ctx.ky.get("story/delete/one").json();case 2:t=e.sent;case 3:if(!t.path){e.next=11;break}return e.next=6,this.sleep(500);case 6:return e.next=8,this.ctx.ky.get("story/delete/one").json();case 8:t=e.sent,e.next=3;break;case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),sleep:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new u.a(function(e,r){setTimeout(function(){e()},t)}));case 1:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()}},l=s,p=(r("61af"),r("2877")),m=Object(p["a"])(l,n,a,!1,null,null,null);t["default"]=m.exports}}]);
//# sourceMappingURL=story-manage.6337906a.js.map